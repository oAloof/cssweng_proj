<!DOCTYPE html>
<html>
    <head>
        <!--Assigned to Ryan-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/css/editproductdetailsadmin.css">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Edit Product Details (Admin)</title>
        <!--This page is for editing details on products-->
        <!--Admins only-->
    </head>
    <body>
        <div class="page-container">
            <div class="logo-container"> <!--Website Logo-->
                <a href="#"><img class="logo" src="/images/BXlogo.png" alt="Logo"></a> <!--The logo link should send you to the homepage-->
            </div>
            <%- include('../partials/admin_NavBar') %>
            <div class="outermost-shell"> <!--Contains all the input boxes and buttons-->
                <div class="left-outer-shell"> <!--Contains input images & image scrollbar-->
                    <div class="image-with-delete">
                        <a class="img-container" href="#"><img class="image" src="/images/uploadimage.png"></a>
                        <a class="del-hover" href="#">X</a>
                    </div>
                    <div class="error-msg-container">
                        <a class="error-msg-img">Upload at least (1) image</a>
                    </div>
                    <div class="img-grid">
                        <div class="scroll-image-1">
                            <!-- <a class="addimage-container-1" href="#"><img class="addimage-1" src="/images/uploadimage.png"></a> -->
                            <% if (product.images && product.images[0]) { %>
                                <a class="addimage-container-1" href="#">
                                  <!-- Ensure the file ID in the src URL is publicly accessible -->
                                  <img class="addimage-1" src="https://drive.google.com/uc?export=view&id=<%= product.images[0] %>">
                                </a>
                              <% } else { %>
                                <a class="addimage-container-1" href="#">
                                  <img class="addimage-1" src="/images/uploadimage.png">
                                </a>
                              <% } %>
                            <a class="scroll-del-hover-1" href="#">X</a>
                            
                            <!-- <a class="addimage-container-2" href="#"><img class="addimage-2" src="/images/uploadimage.png"></a> -->
                            <% if (product.images && product.images[1]) { %>
                                <a class="addimage-container-2" href="#">
                                  <img class="addimage-2" src="https://drive.google.com/uc?export=view&id=<%= product.images[1] %>">
                                </a>
                              <% } else { %>
                                <a class="addimage-container-2" href="#">
                                  <img class="addimage-2" src="/images/uploadimage.png">
                                </a>
                              <% } %>
                            <a class="scroll-del-hover-2" href="#">X</a>
                            
                            <!-- <a class="addimage-container-3" href="#"><img class="addimage-3" src="/images/uploadimage.png"></a> -->
                            <% if (product.images && product.images[2]) { %>
                                <a class="addimage-container-3" href="#">
                                  <img class="addimage-3" src="https://drive.google.com/uc?export=view&id=<%= product.images[2] %>">
                                </a>
                              <% } else { %>
                                <a class="addimage-container-3" href="#">
                                  <img class="addimage-3" src="/images/uploadimage.png">
                                </a>
                              <% } %>
                            <a class="scroll-del-hover-3" href="#">X</a>
                        </div>
                        <div class="scroll-image-2">
                            <!-- <a class="addimage-container-1" href="#"><img class="addimage-1" src="/images/uploadimage.png"></a>

                            <a class="scroll-del-hover-1" href="#">X</a>
                            <a class="addimage-container-2" href="#"><img class="addimage-2" src="/images/uploadimage.png"></a>
                            
                            <a class="scroll-del-hover-2" href="#">X</a>
                            <a class="addimage-container-3" href="#"><img class="addimage-3" src="/images/uploadimage.png"></a>
                            <a class="scroll-del-hover-3" href="#">X</a> -->
                        </div>
                    </div>
                </div>
                <div class="right-outer shell"> <!--Contains text & drop down inputs-->
                    <div class="right-inner-shell-row-1"> <!--Product Name & Price-->
                        <div class="error-msg-container">
                            <input class="input-product-name" type="email" id="name" placeholder="Product name.." value="<%= product.name %>">
                            <a class="error-msg-name-1">Please enter the product name</a>
                            <a class="error-msg-name-2">That product name is already listed</a>
                        </div>
                        <a class="peso-symbol">â‚±</a>
                        <div class="error-msg-container">
                            <input class="input-product-price" type="text" id="price" placeholder="0" value="<%= product.price %>">
                            <a class="error-msg-price">Please enter the product price</a>
                        </div>
                    </div>
                    <div class="right-inner-shell-row-2"> <!--Product Brand-->
                        <div class="error-msg-container">
                            <input class="input-product-brand" type="text" id="brand" placeholder="Product brand.." value="<%= product.brand %>">
                            <a class="error-msg-brand">Please enter the product brand</a>
                        </div>
                    </div>
                    <div class="right-inner-shell-row-3"> <!--Available Stock & Available Quantity-->
                        <input class="input-product-stock" type="text" id="stock" placeholder="0" value="<%= product.quantity %>">
                        <a class="stock-available-text">Stock Available</a>
                        <div class="error-msg-container">
                            <select class="list-dropdown">
                                <option value="listed">--Select a List Status--</option>
                                <option value="listed" <% if (product.status === 'listed') { %>selected<% } %>>Listed</option>
                                <option value="unlisted" <% if (product.status === 'unlisted') { %>selected<% } %>>Unlisted</option>
                            </select>
                            <a class="error-msg-list">Please select this product's list status</a>
                        </div>
                        <a class="list-status-text">List Status</a>
                    </div>
                    <div class="right-inner-shell-row-4"> <!--Product Description-->
                        <div class="error-msg-container">
                            <input class="input-product-description" type="text" id="description" placeholder="Product description.." value= "<%= product.description %>">
                            <a class="error-msg-description">Please enter the product description</a>
                        </div>
                    </div>
                    <div class="right-inner-shell-row-5"> <!--Discard Changess & Save Buttons-->
                        <button class="save-button">Save Changes</button>
                        <button id="discard-btn" class="discard-button">Discard Changes</button>
                        <button class="delete-button">Delete Product</button>
                    </div>
                </div>
            </div>
        </div>

        <script>

            document.getElementById("discard-btn").addEventListener("click", () => {
                window.location.href = "/admin/products"
            })

            document.querySelector('.save-button').addEventListener('click', () => {
                    const name = document.querySelector('.input-product-name').value
                    const brand = document.querySelector('.input-product-brand').value
                    const price = document.querySelector('.input-product-price').value
                    const quantity = document.querySelector('.input-product-stock').value
                    const description = document.querySelector('.input-product-description').value
                    const status = document.querySelector('.list-dropdown').value

                    const pathArray = window.location.pathname.split('/')
                    const productId = pathArray[pathArray.length - 1]
                    const data = {
                        name,
                        brand,
                        price,
                        quantity,
                        description, 
                        status,
                        productId
                    }

                    fetch('/admin/products/edit/:id', {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then( data => {
                        console.log(data)
                        window.location.href = '/admin/products?' + new Date().getTime() // This is to refresh the page
                    })
                })
        </script>

    </body>
</html>